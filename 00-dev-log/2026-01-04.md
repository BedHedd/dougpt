# 2026-01-06
## overall progress
- [ ] investigate ffmpeg compression options
- [ ] come up with some ideas for things I want 

## investigate ffmpeg compression options
It took me a couple hours to get the approximate timestamps. I didn't feel like spending an entire day to continue the process for the entire video. Instead I'll just work with a 10ish minute segment. 

## sidequest: cutting and encoding the video
I downloaded the video using yt-dlp
```
yt-dlp https://youtu.be/VpmmuHlLPM0?si=32cf0eWU-F0PaneF
```
the 1080p 60fps vod was 3 gigabytes, so I wanted to extract my 10:34 minute segment (634 seconds)

I started by trying the parameters of ffshare
https://github.com/caydey/ffshare
```
ffmpeg -y -i INPUT_FILE_NAME.mp4 \
  -map 0:v:0 -an \
  -c:v libx264 -preset slow -crf 23 -maxrate 2M -bufsize 2M \
  -vf format=yuv420p \
  OUTPUT_FILE_NAME.mp4
````
For all the other ffmpeg settings, I had chatgpt modify the codeblock above for other encoders quality and format

### summary of files
To make it easier to compare, I made a table for the ffmpeg commands

|Filename | FFMPEG Command | File Size (MiB) | Youtube video URL|
|--- | --- | --- | ---|
|Doug-ai-invasion-10-minute-cut.mp4 | ``` ffmpeg -y -i Doug\ and\ Twitch\ Chat\ TAKE\ OVER\ EUROPE-VpmmuHlLPM0.mkv -ss 0 -t 634 \                                                 -c:v libx264 -preset veryslow -crf 17 -pix_fmt yuv420p \                                                 -c:a copy \                                                 Doug-ai-invasion-10-minute-cut.mp4 ``` | 217.1 | https://youtu.be/ACdHmzWD0F0|
|Doug-ai-invasion-10-minute-cut-ffshare-compress-true.mp4 | ``` ffmpeg -y -i Doug\ and\ Twitch\ Chat\ TAKE\ OVER\ EUROPE-VpmmuHlLPM0.mkv \                                                 -ss 0 -t 634 \                                                 -map 0:v:0 -map 0:a:0 \                                                 -c:v libx264 -preset slow -crf 23 -maxrate 2M -bufsize 2M \                                                 -vf format=yuv420p \                                                 -c:a copy \                                                 Doug-ai-invasion-10-minute-cut-ffshare-compress-true.mp4 ``` | 111.0 | https://youtu.be/JSPrwzYljKg|
|Doug-ai-invasion-10-minute-cut-compressed.mp4 | ``` ffmpeg -y -i Doug\ and\ Twitch\ Chat\ TAKE\ OVER\ EUROPE-VpmmuHlLPM0.mkv -ss 0 -t 634 \                                                 -c:v libx264 -preset slow -crf 18 -pix_fmt yuv420p \                                                 -c:a copy \                                                 Doug-ai-invasion-10-minute-cut-compressed.mp4  ``` | 227.8 | https://youtu.be/l424AA8B_Wk|
|Doug-ai-invasion-10-minute-cut-av1.mp4 | ``` ffmpeg -y -i Doug\ and\ Twitch\ Chat\ TAKE\ OVER\ EUROPE-VpmmuHlLPM0.mkv -ss 0 -t 634 \                                                 -c:v libsvtav1 -preset 6 -crf 28 -b:v 0 \                                                 -maxrate 2M -bufsize 2M \                                                 -pix_fmt yuv420p \                                                 -c:a copy \                                                 -movflags +faststart \                                                 Doug-ai-invasion-10-minute-cut-av1.mp4 ``` | 154.6 | https://youtu.be/9NwodvY7BzQ|
|Doug-ai-invasion-10-minute-cut-ffshare-compress.mp4  | ```ffmpeg -y -i Doug\ and\ Twitch\ Chat\ TAKE\ OVER\ EUROPE-VpmmuHlLPM0.mkv \                                                 -ss 0 -t 634 \                                                 -map 0:v:0 -map 0:a:0 \                                                 -c:v libx264 -preset slow -crf 26 \                                                 -vf format=yuv420p \                                                 -c:a copy \                                                 Doug-ai-invasion-10-minute-cut-ffshare-compress.mp4 ``` | 123.4  | https://youtu.be/WkJco2WVlxc|
|better-video-qualityDoug and Twitch Chat TAKE OVER EUROPE-VpmmuHlLPM0.15mb  | ``` ffmpeg -y -i "Doug and Twitch Chat TAKE OVER EUROPE-VpmmuHlLPM0.mkv"-ss 00:00:00 -to 00:10:34 -map 0:v:0 -an -c:v libsvtav1 -preset 8 -b:v 1200k -pass 1 -passlogfile "av1pass" -pix_fmt yuv420p -f webm /dev/null && ffmpeg -y -i "Doug and Twitch Chat TAKE OVER EUROPE-VpmmuHlLPM0.mkv" -ss 00:00:00 -to 00:10:34 -map 0:v:0 -map 0:a:0? -c:v libsvtav1 -preset 8 -b:v 1200k -pass 2 -passlogfile "av1pass" -pix_fmt yuv420p -c:a libopus -b:a 64k "better-video-qualityDoug and Twitch Chat TAKE OVER EUROPE-VpmmuHlLPM0.15mb.webm"``` | 96.2  | https://youtu.be/HiDjpC0Vokg|
|Doug and Twitch Chat TAKE OVER EUROPE-VpmmuHlLPM0.15mb.webm  | ``` ffmpeg -y -i "Doug and Twitch Chat TAKE OVER EUROPE-VpmmuHlLPM0.mkv" -ss 0 -t 634 -map 0:v:0 -an -c:v libsvtav1 -preset 8 -b:v 130k -pass 1 -passlogfile "av1pass15" -pix_fmt yuv420p -f webm /dev/null && ffmpeg -y -i "Doug and Twitch Chat TAKE OVER EUROPE-VpmmuHlLPM0.mkv" -ss 0 -t 634 -map 0:v:0 -map 0:a:0? -c:v libsvtav1 -preset 8 -b:v 130k -pass 2 -passlogfile "av1pass15" -pix_fmt yuv420p -c:a libopus -b:a 64k "Doug and Twitch Chat TAKE OVER EUROPE-VpmmuHlLPM0.15mb.webm"``` | 18.6  | https://youtu.be/pXkZp5De_N0|

### comparisons
The source clip is 217.1 MiB and will serve as our frame of reference
https://youtu.be/ACdHmzWD0F0

I took the ones that I liked and put it into a presets repo
https://github.com/BedHedd/ffcompress

I can't adequately explain the parameters, but based on a inspection these were some I wanted to highlight. The presets denoted with ```  `PRESET` ``` codeblocks correspond with the presets of the repo

| preset | python | ffmpeg command(s) |
|---|---|---|
| `ffshare` | `python ffcompress.py --preset ffshare /home/bedhedd/videos/input.mkv` | `ffmpeg -y -i /home/bedhedd/videos/input.mkv -map 0:v:0 -map '0:a:0?' -c:v libx264 -crf 23 -maxrate 2M -bufsize 2M -pix_fmt yuv420p -vf format=yuv420p -c:a aac input.ffshare.mp4` |
| `av1_15mb_audio` | `python ffcompress.py --preset av1_15mb_audio /home/bedhedd/videos/input.mkv` | `ffmpeg -y -i /home/bedhedd/videos/input.mkv -map 0:v:0 -map '0:a:0?' -an -c:v libsvtav1 -preset 8 -b:v 137k -pix_fmt yuv420p -pass 1 -passlogfile input.av1_15mb_audio.av1pass -f webm /dev/null`<br><br>`ffmpeg -y -i /home/bedhedd/videos/input.mkv -map 0:v:0 -map '0:a:0?' -c:v libsvtav1 -preset 8 -b:v 137k -pix_fmt yuv420p -pass 2 -passlogfile input.av1_15mb_audio.av1pass -c:a libopus -b:a 64k input.av1_15mb_audio.webm` |
| `av1_2pass_1200k_opus64` | `python ffcompress.py --preset av1_2pass_1200k_opus64 /home/bedhedd/videos/input.mkv` | `ffmpeg -y -i /home/bedhedd/videos/input.mkv -map 0:v:0 -map '0:a:0?' -an -c:v libsvtav1 -preset 8 -b:v 1200k -pix_fmt yuv420p -pass 1 -passlogfile input.av1_2pass_1200k_opus64.av1pass -f webm /dev/null`<br><br>`ffmpeg -y -i /home/bedhedd/videos/input.mkv -map 0:v:0 -map '0:a:0?' -c:v libsvtav1 -preset 8 -b:v 1200k -pix_fmt yuv420p -pass 2 -passlogfile input.av1_2pass_1200k_opus64.av1pass -c:a libopus -b:a 64k input.av1_2pass_1200k_opus64.webm` |


#### `ffshare`: share to discord and file upload
ffshare's settings had a good tradeoff of video size and quality. If I don't want to think about my encoding for mp4, it's a great default that reduces the file size by a factor of ___1.9___ (217 / 111).
https://youtu.be/JSPrwzYljKg

#### `av1_15mb_audio`: max compression
If I were going for max compression, I'd go for the last option `Doug and Twitch Chat TAKE OVER EUROPE-VpmmuHlLPM0.15mb.webm`. This output is just barely legible and reduces the size by a factor of ___12___ (217 /18)
https://youtu.be/pXkZp5De_N0
To get a I had chatgpt write a script to compress the file beyond the ffshare example and uses av1 for the video codec. The script will take a 2 pass step for compressing the video. The first pass will get the bitrate stats for the video to determine how to compress it, the second will apply the bitrate stats to re-encode the video.

#### `av1_2pass_1200k_opus64`: goldilocks between ffshare and max comphression
If I wanted a middle ground between ffshare and chatgpt's script, I would go for `better-video-qualityDoug and Twitch Chat TAKE OVER EUROPE-VpmmuHlLPM0.15mb`, as it reduces the size by a factor of ___2.2___ (217 / 96)

# what's next?
These are some ideas I have, they might be dedicated posts or covered in a future session:
- [ ] have chatgpt write scripts to process the compressed videos:
   - [ ] programmatically find chat and detect changes in messages, figure out what chunking strategy to apply
   - [ ] compare computer vision techniques to extracting text on screen: 
       - [ ] try a vision or multimodal language model 
       - [ ] try a traditional ocr model
   - [ ] sync chat message timestamps with transcript so that we can have doug as the user and chat as the system
- [ ] compare whisper transcripts vs youtube's transcripts
- [ ] pray that above methods work and scale to the rest of the video

Moving forward, I think I'll go with the av1 encoded versions, and start with the  `av1_15mb_audio` version to see how well computer vision and ocr perform off of the video frames.

Since I just want to parse for chat messages, it might be better to only sample frames where text has already passed through
## next steps
- [ ] have chatgpt write scripts to process the compressed videos:
   - [ ] programmatically find chat and detect changes in messages, figure out what chunking strategy to apply
   - [ ] compare computer vision techniques to extracting text on screen: 
       - [ ] try a vision or multimodal language model 
       - [ ] try a traditional ocr model
   - [ ] sync chat message timestamps with transcript so that we can have doug as the user and chat as the system
- [ ] compare whisper transcripts vs youtube's transcripts
- [ ] pray that above methods work and scale to the rest of the video